<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Cardwolla</title>

	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	
	<script type="text/javascript"  src="//cdnjs.cloudflare.com/ajax/libs/jquery.payment/1.0.1/jquery.payment.js"></script>

	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/spin.js/1.3.3/spin.min.js"></script>
	
	<!-- Custom Google Web Font -->
	<link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href='//fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>

	<!-- Add custom CSS here -->
	<link href="/styles/landing-page.css" rel="stylesheet">
	
	<script>
	$(function() {
		var checkIt = function() {
			var val = $('#card_number').val().replace(/\s/g, '');
			if(val.length == 16) {
				$.get('/api/hasdwolla', {
					card: val
				}, function(response) {
					if(response.hasdwolla) {
						$('#paywithcc').hide();
						$('#paywithdwolla').show()
					} else {
						$('#paywithcc').show();
						$('#paywithdwolla').hide();
					}
				}, 'JSON');
			} else {
				$('#paywithcc').show();
				$('#paywithdwolla').hide();
			}
		};
	
		$('#card_number').keyup(checkIt);
		$('#card_number').change(checkIt);
		
		var listenIfNothingFocused = function() {
			if(!$('#card_number').is(":focus") && !$('#card_exp').is(":focus")) {
				$('#scanner_input').focus();
			}
		};
		
		$('#card_number').blur(listenIfNothingFocused);
		$('#card_exp').blur(listenIfNothingFocused);
		
		$('#scanner_form').submit(function(e) {
			e.preventDefault();
			
			var raw = $('#scanner_input').val();
			$('#scanner_input').val('');
			
			var cardParts = raw.split('=');
			
			var card_number = cardParts[0];
			var exp_month = cardParts[1].substring(2, 4);
			var exp_year = '20' + cardParts[1].substring(0, 2);
			
			$('#card_number').val(card_number);
			$('#card_exp').val(exp_month + '/' + exp_year);
			
			checkIt();
		});
		
		$('#scanner_input').focus(function() {
			$(this).val('');
		});
		
		$('#scanner_input').focus();
		
		$('#card_number').formatCardNumber();
		$('#card_exp').formatCardExpiry();
	});
	</script>
	
	<style>
		html, body { 
			background: url(/img/constitution.jpg) no-repeat center center fixed; 
			-webkit-background-size: cover;
			-moz-background-size: cover;
			-o-background-size: cover;
			background-size: cover;
			height: 100%;
			width: 100%;
		}
		
		#theForm {
			width: 400px;
			margin: 30px auto 15px;
			border: 1px solid #CCC;
			padding: 0px 30px 20px 30px;
			background-color: white;
		}
		
		#theFooter {
			width: 400px;
			margin: 0px auto;
			border: 1px solid #CCC;
			padding: 10px 30px;
			background-color: white;
			text-align: center;
		}
		
		form {
			text-align: center;
		}
		
		#card_number {
			width: 210px;
		}
		
		#cvv {
			width: 65px;
		}
		
		#paywithdwolla {
			display: none;
		}
	</style>
</head>
<body>

	<div id="theForm">
		<h1>Cardwolla Demo</h1>
		<p>
			First, try paying a dollar with your credit card. The money will be
			charged via Stripe.
		</p>
		<p>
			Then sign up at <a href="/">cardwolla.com</a>.
			and link your credit card to your Dwolla account.
		</p>
		<p>
			When you come back
			to this page and enter your card you will be charged through Dwolla
			instead.
		</p>
		
		<hr />
		
		
			<form class="form-inline" role="form" id="add_card" autocomplete="on" pattern="\d*">
				<div class="form-group">
					<label class="inline-lbl control-label" for="card_number">Card Number</label>
					<input type="text" class="form-control input-lg" id="card_number" placeholder="1111 2222 3333 4444" />
				</div>
				<div class="form-group">
					<label class="inline-lbl control-label" for="exp">Expiration</label>
					<input type="text" class="form-control input-lg" id="card_exp" placeholder="12/2020" />
				</div>
				<br /><br />
				<button type="submit" id="paywithcc" class="btn btn-primary btn-lg">Pay $1 with Credit Card</button>
				<button type="submit" id="paywithdwolla" class="btn btn-warning btn-lg">Pay $1 with Dwolla</button>
			</form>
<!--		
		  <div class="form-row">
		    <label>
		      <span>Card Number</span>
		      <input type="text" size="20" data-stripe="number"/>
		    </label>
		  </div>
		
		  <div class="form-row">
		    <label>
		      <span>CVC</span>
		      <input type="text" size="4" data-stripe="cvc"/>
		    </label>
		  </div>
		
		  <div class="form-row">
		    <label>
		      <span>Expiration (MM/YYYY)</span>
		      <input type="text" size="2" data-stripe="exp-month"/>
		    </label>
		    <span> / </span>
		    <input type="text" size="4" data-stripe="exp-year"/>
		  </div>
	
		  <button type="submit">Submit Payment</button>
-->
	</div>
	
	<div id="theFooter">
		Created by Brad Dwyer for PennApps 2014
	</div>


	<form id="scanner_form" style="position: absolute; top: -1000px;"><input type="text" id="scanner_input" /></form>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
	  ga('create', 'UA-48092075-1', 'cardwolla.com');
	  ga('send', 'pageview');
	
	</script>
</body>
</html>